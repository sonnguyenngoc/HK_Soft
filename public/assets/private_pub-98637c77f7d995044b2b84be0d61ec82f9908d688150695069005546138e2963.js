function buildPrivatePub(doc){var self={connecting:!1,fayeClient:null,fayeCallbacks:[],subscriptions:{},subscriptionCallbacks:{},faye:function(n){if(self.fayeClient)n(self.fayeClient);else if(self.fayeCallbacks.push(n),self.subscriptions.server&&!self.connecting){self.connecting=!0;var l=doc.createElement("script");l.type="text/javascript",l.src=self.subscriptions.server+".js",l.onload=self.connectToFaye,doc.documentElement.appendChild(l)}},connectToFaye:function(){self.fayeClient=new Faye.Client(self.subscriptions.server),self.fayeClient.addExtension(self.fayeExtension);for(var n=0;n<self.fayeCallbacks.length;n++)self.fayeCallbacks[n](self.fayeClient)},fayeExtension:{outgoing:function(n,l){if("/meta/subscribe"==n.channel){var i=self.subscriptions[n.subscription];n.ext||(n.ext={}),n.ext.private_pub_signature=i.signature,n.ext.private_pub_timestamp=i.timestamp}l(n)}},sign:function(n){self.subscriptions.server||(self.subscriptions.server=n.server),self.subscriptions[n.channel]=n,self.faye(function(l){l.subscribe(n.channel,self.handleResponse)})},handleResponse:function(message){message.eval&&eval(message.eval),(callback=self.subscriptionCallbacks[message.channel])&&callback(message.data,message.channel)},subscribe:function(n,l){self.subscriptionCallbacks[n]=l}};return self}var PrivatePub=buildPrivatePub(document);